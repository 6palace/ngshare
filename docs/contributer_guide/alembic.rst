Migration with Alembic
======================

Whenever the database structure is changed, developers should update migration instructions for the database using alembic. The default ngshare configuration automatically upgrades the database when starting.

Upgrade Database
----------------
This is automatically done in vanilla ngshare and vngshare implementations.

.. code:: bash

    cd ngshare
    python3 dbutil.py upgrade head

Create New Version
------------------
After a change is made in ``ngshare/database/database.py``, use the following command to generate a migration script.

"It is always necessary to manually review and correct the candidate migrations that autogenerate produces."

.. code:: bash

    cd ngshare
    python3 dbutil.py revision --autogenerate -m "MESSAGE"
    vi alembic/versions/REVID_MESSAGE.py

``MESSAGE`` is your message for the update.

``REVID`` is the revision ID generated by Alembic.

Reference
---------

* `https://alembic.sqlalchemy.org/en/latest/tutorial.html
  <https://alembic.sqlalchemy.org/en/latest/tutorial.html>`_
* `https://alembic.sqlalchemy.org/en/latest/autogenerate.html
  <https://alembic.sqlalchemy.org/en/latest/autogenerate.html>`_

