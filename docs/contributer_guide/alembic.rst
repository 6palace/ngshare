Migration with Alembic
======================

Whenever database structure is changed, developers should update migration instructions in for the database using alembic. The default ngshare configuration automatically upgrades database when starting.

Upgrade database
----------------
This is automatically completed in default ngshare and vngshare implementation

.. code:: bash

    cd ngshare
    python3 dbutil.py upgrade head

Create new version
------------------
After a change made in ``ngshare/database/database.py``, use the following command to generate a migration script.

"It is always necessary to manually review and correct the candidate migrations that autogenerate produces."

.. code:: bash

    cd ngshare
    python3 dbutil.py revision --autogenerate -m "MESSAGE"
    vi alembic/versions/REVID_MESSAGE.py

``MESSAGE`` is your message for the update.

``REVID`` is revision ID generated by Alembic.

Reference
---------

* `https://alembic.sqlalchemy.org/en/latest/tutorial.html
  <https://alembic.sqlalchemy.org/en/latest/tutorial.html>`_
* `https://alembic.sqlalchemy.org/en/latest/autogenerate.html
  <https://alembic.sqlalchemy.org/en/latest/autogenerate.html>`_

